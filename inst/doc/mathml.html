<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Matthias Gondan and Irene Alfarone (Department of Psychology, Universität Innsbruck, Austria)" />

<meta name="date" content="2023-01-14" />

<title>mathml: Translate R expressions to MathML and LaTeX/MathJax</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">mathml: Translate R expressions to MathML
and LaTeX/MathJax</h1>
<h4 class="author">Matthias Gondan and Irene Alfarone (Department of
Psychology, Universität Innsbruck, Austria)</h4>
<h4 class="date">2023-01-14</h4>



<p>This R package translates R objects to suitable elements in MathML or
LaTeX, thereby allowing for a pretty mathematical representation of
R objects and functions in data analyses, scientific reports and
interactive web content. In the RMarkdown document rendering language,
R code and mathematical content already exist side-by-side. The present
package allows to use the same R objects for both data analysis and
typesetting in documents or web content. This tightens the link between
the statistical analysis and its verbal description or symbolic
representation, which is another step towards reproducible science.
User-defined hooks allow to extend the package by mapping specific
variables or functions to new MathML and LaTeX entities. A few working
examples illustrate the use of the package in a scientific report.</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The R extension of the markdown language <span class="citation">(Xie,
Dervieux, and Riederer 2020)</span> enables reproducible statistical
reports with nice typesetting in HTML, Microsoft Word, and Latex. Since
recently <span class="citation">(R Core Team 2022, version 4.2)</span>,
R&#39;s manual pages include support for mathematical expressions <span class="citation">(Sarkar and Hornik 2022; Viechtbauer 2022)</span>,
which already is a big improvement. However, rules for the mapping of
built-in language elements to their mathematical representation are
still lacking. So far, R expressions such as
<code>pbinom(k, N, p)</code> are printed as they are; pretty
mathematical formulae such as <span class="math inline">\(P_{\mathrm{Bi}}(X \le k; N, p)\)</span> require
explicit Latex commands, that is,
<code>P_{\mathrm{Bi}}\left(X \le k; N, p\right)</code>. Except for
minimalistic use cases, these commands are tedious to type in and their
source code is hard to read.</p>
<p>The present R package defines a set of rules for the automatic
translation of R expressions to mathematical output in RMarkdown
documents <span class="citation">(Xie, Dervieux, and Riederer
2020)</span> and ShinyApp webpages <span class="citation">(Chang et al.
2022)</span>. The translation is done by an embedded Prolog interpreter
that maps nested expressions recursively to MathML and LaTeX/MathJax,
respectively. User-defined hooks enable to extend the set of rules, for
example, to represent specific R elements by custom mathematical
signs.</p>
<p>The main feature of the package is that the same R expressions and
equations can be used for both mathematical typesetting and
calculations. This saves time and reduces mistakes, as will be
illustrated below.</p>
<p>The paper is organized as follows. Section 2 presents the technical
background of the package, including the two main classes of Prolog
rules for translating R objects to mathematical expressions. Section 3
illustrates the main features of the <em>mathml</em> package, potential
issues and workarounds using examples from the day-to-day perspective of
a user. Section 4 present a case study for the use of the package in a
scientific report. Section 5 concludes with a discussion and ideas for
further development.</p>
</div>
<div id="background" class="section level1">
<h1>Background</h1>
<p>The translation of R expressions to mathematical output is achieved
through a Prolog interpreter. Prolog is a classical logic programming
language with many applications in expert systems, computer linguistics
and symbolic artificial intelligence. The main strength of Prolog is its
concise representation of facts and rules for the representation of
knowledge and grammar, as well as its efficient built-in search engine
for closed world domains. As it is well-known, R is a statistical
programming language for data analysis and statistical modeling which is
widely used in academia and industry. Besides the core library, a lot of
packages have been developed for all kinds of statistical problems,
including statistics-based artificial intelligence tools such as neural
networks for machine learning and deep learning. Whereas Prolog is weak
in statistical computation, but strong in symbolic manipulation, the
converse may be said for the R language. The <em>rolog</em> package
<span class="citation">(Gondan 2022)</span> bridges this gap by
providing an interface to a SWI-Prolog distribution in R. The
communication between the two systems is mainly in the form of queries
from R to Prolog, but two predicates allow Prolog to ring back and
evaluate terms in R.</p>
<p>For a first illustration of the <em>mathml</em> package, we consider
the binomial probability.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">pbinom</span>(k, N, p))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>term</span></code></pre></div>
<pre><code>## pbinom(k, N, p)</code></pre>
<p>The term is quoted to avoid its immediate evaluation (which would
raise an error anyway since the variables <code>k</code>,
<code>N</code>, <code>p</code> have not yet been defined). Experienced
readers will remember that the quoted expression above is a short form
for</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">call</span>(<span class="st">&quot;pbinom&quot;</span>, <span class="fu">as.name</span>(<span class="st">&quot;k&quot;</span>), <span class="fu">as.name</span>(<span class="st">&quot;N&quot;</span>), <span class="fu">as.name</span>(<span class="st">&quot;p&quot;</span>))</span></code></pre></div>
<p>As is seen from the output above, the variable <code>term</code> is
not assigned the result of the calculation, but an R “call” <span class="citation">(see, e.g., Wickham 2019, for details on “non-standard
evaluation”)</span>. This call can eventually be evaluated with
<code>eval()</code>,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">22</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(term)</span></code></pre></div>
<pre><code>## [1] 0.77195</code></pre>
<p>The R package <em>mathml</em> can now be used to render the call in
MathML, that is the dialect for mathematical elements on HTML webpages
or in MathJax/LaTeX, as shown below (some of the curly braces are not
really needed in this simple example, but are necessary in edge
cases).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mathml)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathjax</span>(term)</span></code></pre></div>
<pre><code>## [1] &quot;${P}_{\\mathrm{Bi}}{\\left({{X}{\\le}{k}}{{;}{{N}{{,}{p}}}}\\right)}$&quot;</code></pre>
<p>We can include the output in a RMarkdown document by specifying
<code>results=&#39;asis&#39;</code> in the R code chunk, as is done in the next
example. The R function <code>mathout()</code> is a wrapper that invokes
<code>mathml()</code> for HTML output and <code>mathjax()</code> for
LaTeX output.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><msub><mi>P</mi><mtext>Bi</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>k</mi></mrow><mo>;</mo><mrow><mi>N</mi><mo>,</mo><mi>p</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></p>
<p>At the Prolog end, a predicate <code>math/2</code> translates the
call <code>pbinom(K, N, Pi)</code> into a “function” <code>fn/2</code>
with the name <code>P_Bi</code>, one argument <code>X =&lt; K</code>,
and the two parameters <code>N</code> and <code>Pi</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode prolog"><code class="sourceCode prolog"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>math(pbinom(<span class="dt">K</span><span class="kw">,</span> <span class="dt">N</span><span class="kw">,</span> <span class="dt">Pi</span>)<span class="kw">,</span> <span class="dt">M</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> =&gt; <span class="dt">M</span> <span class="kw">=</span> fn(subscript(<span class="st">&#39;</span><span class="er">P</span><span class="st">&#39;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">Bi</span><span class="ot">&quot;</span>)<span class="kw">,</span> ([<span class="st">&#39;</span><span class="er">X</span><span class="st">&#39;</span> <span class="dt">=&lt;</span> <span class="dt">K</span>] <span class="kw">;</span> [<span class="dt">N</span>, <span class="dt">Pi</span>]))<span class="kw">.</span></span></code></pre></div>
<p>Thus, the predicate <code>math/2</code> could be considered a “macro”
that translates a mathematical element (here,
<code>pbinom(K, N, Pi)</code>) to a different mathematical element,
namely <code>fn(Name, (Args ; Pars))</code>. The low-level predicate
<code>ml/3</code> is used to convert these basic elements to MathML.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode prolog"><code class="sourceCode prolog"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ml(<span class="dt">Flags</span><span class="kw">,</span> fn(<span class="dt">Name</span><span class="kw">,</span> (<span class="dt">Args</span> <span class="kw">;</span> <span class="dt">Pars</span>))<span class="kw">,</span> <span class="dt">M</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a> =&gt; ml(<span class="dt">Flags</span><span class="kw">,</span> <span class="dt">Name</span><span class="kw">,</span> <span class="dt">N</span>)<span class="kw">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    ml(<span class="dt">Flags</span><span class="kw">,</span> paren(list(<span class="fu">op</span>(<span class="kw">;</span>)<span class="kw">,</span> [list(<span class="fu">op</span>(<span class="st">&#39;,&#39;</span>)<span class="kw">,</span> <span class="dt">Args</span>), list(<span class="fu">op</span>(<span class="st">&#39;,&#39;</span>)<span class="kw">,</span> <span class="dt">Pars</span>)]))<span class="kw">,</span> <span class="dt">X</span>)<span class="kw">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">M</span> <span class="kw">=</span> mrow([<span class="dt">N</span>, mo(&amp;(af)), <span class="dt">X</span>])<span class="kw">.</span></span></code></pre></div>
<p>The relevant rule for <code>ml/3</code> builds the MathML entity
<code>mrow([N, mo(&amp;(af)), X])</code>, with <code>N</code>
representing the name of the function and <code>X</code> its arguments
and parameters, enclosed in parentheses. A corresponding rule
<code>jax/3</code> does the same for MathJax/LaTeX. A list of flags can
be used for context-sensitive translation (see, e.g., the errors
below).</p>
</div>
<div id="package-mathml-in-practice" class="section level1">
<h1>Package <em>mathml</em> in practice</h1>
<p><em>mathml</em> is an R package for pretty mathematical
representation of R functions and objects in data analysis, scientific
reports and interactive web content. The currently supported features
are listed below, roughly following the order proposed by <span class="citation">(Murrell and Ihaka 2000)</span>.</p>
<div id="basic-elements" class="section level2">
<h2>Basic elements</h2>
<p><em>mathml</em> handles the basic elements of everyday mathematical
expressions, such as numbers, Latin and Greek letters, multi-letter
identifiers, accents, subscripts, and superscripts.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="sc">-</span>2L <span class="sc">+</span> a <span class="sc">+</span> abc <span class="sc">+</span> <span class="st">&quot;a&quot;</span> <span class="sc">+</span> phi <span class="sc">+</span> Phi <span class="sc">+</span> varphi <span class="sc">+</span> <span class="fu">hat</span>(b)[i, j]<span class="sc">^</span>2L)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mrow><mrow><mrow><mrow><mrow><mn>1.00</mn><mo>+</mo><mrow><mo>-</mo><mn>2</mn></mrow></mrow><mo>+</mo><mi>a</mi></mrow><mo>+</mo><mi>abc</mi></mrow><mo>+</mo><mtext>a</mtext></mrow><mo>+</mo><mi>φ</mi></mrow><mo>+</mo><mi>Φ</mi></mrow><mo>+</mo><mi>ϕ</mi></mrow><mo>+</mo><msubsup><mover accent="true"><mi>b</mi><mo>^</mo></mover><mrow><mi>i</mi><mtext></mtext><mi>j</mi></mrow><mn>2</mn></msubsup></mrow></math></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="cn">NaN</span> <span class="sc">+</span> <span class="cn">NA</span> <span class="sc">+</span> <span class="cn">TRUE</span> <span class="sc">+</span> <span class="cn">FALSE</span> <span class="sc">+</span> <span class="cn">Inf</span> <span class="sc">+</span> (<span class="sc">-</span><span class="cn">Inf</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mrow><mrow><mn>nan</mn><mo>+</mo><mi>na</mi></mrow><mo>+</mo><mi>T</mi></mrow><mo>+</mo><mi>F</mi></mrow><mo>+</mo><mi>∞</mi></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mo>-</mo><mi>∞</mi></mrow><mo>)</mo></mrow></mrow></math></p>
<p>An expression such as <code>1 + -2</code> may be considered
unsatisfactory from an aesthetical perspective. It is correct R syntax,
though, and is reproduced accordingly, without the parentheses.
Parentheses around negated numbers or symbols can be added as shown for
<code>-Inf</code>.</p>
<p>Note that an R function <code>hat()</code> does not exist in base R,
it is provided by the package for convenience and points to the identity
function.</p>
</div>
<div id="operators-and-parentheses" class="section level2">
<h2>Operators and parentheses</h2>
<p>Arithmetic operators and parentheses are translated as they are, as
illustrated below.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(a <span class="sc">-</span> ((b <span class="sc">+</span> c)) <span class="sc">-</span> d<span class="sc">*</span>e <span class="sc">+</span> f<span class="sc">*</span>(g <span class="sc">+</span> h) <span class="sc">+</span> i<span class="sc">/</span>j <span class="sc">+</span> k<span class="sc">^</span>(l <span class="sc">+</span> m) <span class="sc">+</span> (n<span class="sc">*</span>o)<span class="sc">^</span>{p <span class="sc">+</span> q})</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mrow><mrow><mrow><mi>a</mi><mo>-</mo><mrow><mo>[</mo><mrow><mo>(</mo><mrow><mi>b</mi><mo>+</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>]</mo></mrow></mrow><mo>-</mo><mrow><mi>d</mi><mo>⁢</mo><mi>e</mi></mrow></mrow><mo>+</mo><mrow><mi>f</mi><mo>⋅</mo><mrow><mo>(</mo><mrow><mi>g</mi><mo>+</mo><mi>h</mi></mrow><mo>)</mo></mrow></mrow></mrow><mo>+</mo><mrow><mi>i</mi><mo>/</mo><mi>j</mi></mrow></mrow><mo>+</mo><msup><mi>k</mi><mrow><mo>(</mo><mrow><mi>l</mi><mo>+</mo><mi>m</mi></mrow><mo>)</mo></mrow></msup></mrow><mo>+</mo><msup><mrow><mo>(</mo><mrow><mi>n</mi><mo>⁢</mo><mi>o</mi></mrow><mo>)</mo></mrow><mrow><mi>p</mi><mo>+</mo><mi>q</mi></mrow></msup></mrow></math></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">dot</span>(a, b) <span class="sc">+</span> <span class="fu">frac</span>(1L, <span class="fu">nodot</span>(c, d <span class="sc">+</span> e)) <span class="sc">+</span> <span class="fu">dfrac</span>(1L, <span class="fu">times</span>(g, h)))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mi>a</mi><mo>⋅</mo><mi>b</mi></mrow><mo>+</mo><mfrac><mn>1</mn><mrow><mi>c</mi><mo>⁢</mo><mrow><mo>(</mo><mrow><mi>d</mi><mo>+</mo><mi>e</mi></mrow><mo>)</mo></mrow></mrow></mfrac></mrow><mo>+</mo><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><mi>g</mi><mo>×</mo><mi>h</mi></mrow></mfrac></mstyle></mrow></math></p>
<p>For multiplications involving only numbers and symbols, the
multiplication sign is omitted. This heuristic does not always produce
the desired result; therefore, <em>mathml</em> defines alternative
multiplication functions <code>dot()</code>, <code>nodot()</code>, and
<code>times()</code> that calculate the product and produce the
respective multiplication signs. Similarly, <code>frac()</code> and
<code>dfrac()</code> can be used for small and large fractions.</p>
<p>For standard operators with known precedence, <em>mathml</em> is
generally able to detect if parentheses are needed; for example,
parentheses are automatically placed around <code>g + h</code> in the
<code>nodot</code>-example. However, we note unecessary parentheses
around <code>l + m</code> above. Thes parentheses are a consequence of
<code>quote(a^(b + c))</code> actually producing a nested R call of the
form <code>&#39;^&#39;(a, (b + c))</code> instead of
<code>&#39;^&#39;(a, b + c)</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(a<span class="sc">^</span>(b <span class="sc">+</span> c))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(term)</span></code></pre></div>
<pre><code>## [1] &quot;^&quot;       &quot;a&quot;       &quot;(b + c)&quot;</code></pre>
<p>For the present purpose, this feature is unfortunate because extra
parentheses around <code>b + c</code> are not needed. The preferred
result is obtained by using the functional form
<code>quote(&#39;^&#39;(k, l + m))</code> of the power, or curly braces as a
workaround (see <code>p + q</code> above).</p>
</div>
<div id="custom-operators" class="section level2">
<h2>Custom operators</h2>
<p>Whereas in standard infix operators, the parentheses typically follow
the rules for precedence, undesirable results may be obtained in custom
operators.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">mean</span>(X) <span class="sc">%+-%</span> <span class="fl">1.96</span> <span class="sc">*</span> s <span class="sc">/</span> <span class="fu">sqrt</span>(N))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mo>(</mo><mrow><mover accent="true"><mi>X</mi><mo>¯</mo></mover><mo>±</mo><mn>1.96</mn></mrow><mo>)</mo></mrow><mo>⋅</mo><mi>s</mi></mrow><mo>/</mo><msqrt><mi>N</mi></msqrt></mrow></math></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="st">&#39;%+-%&#39;</span>(<span class="fu">mean</span>(X), <span class="fl">1.96</span> <span class="sc">*</span> s <span class="sc">/</span> <span class="fu">sqrt</span>(N)))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">mean</span>(X) <span class="sc">%+-%</span> {<span class="fl">1.96</span> <span class="sc">*</span> s <span class="sc">/</span> <span class="fu">sqrt</span>(N)})   <span class="co"># the same</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mover accent="true"><mi>X</mi><mo>¯</mo></mover><mo>±</mo><mrow><mrow><mn>1.96</mn><mo>⁢</mo><mi>s</mi></mrow><mo>/</mo><msqrt><mi>N</mi></msqrt></mrow></mrow></math></p>
<p>The example is a reminder that it is not possible to define the
precedence of custom operators in R, and that expressions with such
operators are evaluated strictly from left to right. As in the previous
example, the solution is to either use the functional form of the
operator or a curly brace to enforce the correct operator
precedence.</p>
<p>More operators are shown in Table 1, including the suggestions by
Murrell and Ihaka <span class="citation">(2000)</span> for graphical
annotations and arrows in R figures.</p>
<table>
<caption>Table 1. Custom operators in mathml</caption>
<colgroup>
<col width="3%" />
<col width="37%" />
<col width="5%" />
<col width="27%" />
<col width="5%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Output</th>
<th align="left">Operator</th>
<th align="left">Output</th>
<th align="left">Operator</th>
<th align="left">Arrow</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A %*% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>×</mo><mi>B</mi></mrow></math></td>
<td align="left">A != B</td>
<td align="left"><math><mrow><mi>A</mi><mo>≠</mo><mi>B</mi></mrow></math></td>
<td align="left">A %&lt;-&gt;% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>↔︎</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">A %.% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⋅</mo><mi>B</mi></mrow></math></td>
<td align="left">A ~ B</td>
<td align="left"><math><mrow><mi>A</mi><mo>∼</mo><mi>B</mi></mrow></math></td>
<td align="left">A %-&gt;% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>→</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">A %x% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⊗</mo><mi>B</mi></mrow></math></td>
<td align="left">A %~~% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>≈</mo><mi>B</mi></mrow></math></td>
<td align="left">A %&lt;-% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>←</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">A %/% B</td>
<td align="left"><math><mrow><mo>⌊</mo><mrow><mi>A</mi><mo>/</mo><mi>B</mi></mrow><mo>⌋</mo></mrow></math></td>
<td align="left">A %==% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>≡</mo><mi>B</mi></mrow></math></td>
<td align="left">A %up% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>↑</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">A %% B</td>
<td align="left"><math><mrow><mi>mod</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>A</mi><mo>,</mo><mi>B</mi></mrow><mo>)</mo></mrow></mrow></math></td>
<td align="left">A %=~% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>≅</mo><mi>B</mi></mrow></math></td>
<td align="left">A %down% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>↓</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">A &amp; B</td>
<td align="left"><math><mrow><mi>A</mi><mo>∧</mo><mi>B</mi></mrow></math></td>
<td align="left">A %prop% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>∝</mo><mi>B</mi></mrow></math></td>
<td align="left">A %&lt;=&gt;% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⇔</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">A | B</td>
<td align="left"><math><mrow><mi>A</mi><mo>∨</mo><mi>B</mi></mrow></math></td>
<td align="left">A %in% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>∈</mo><mi>B</mi></mrow></math></td>
<td align="left">A %=&gt;% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⇒</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">xor(A, B)</td>
<td align="left"><math><mrow><mi>A</mi><mo>⊻</mo><mi>B</mi></mrow></math></td>
<td align="left">intersect(A, B)</td>
<td align="left"><math><mrow><mi>A</mi><mo>∩</mo><mi>B</mi></mrow></math></td>
<td align="left">A %&lt;=% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⇐</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">!A</td>
<td align="left"><math><mrow><mo>¬</mo><mi>A</mi></mrow></math></td>
<td align="left">union(A, B)</td>
<td align="left"><math><mrow><mi>A</mi><mo>∪</mo><mi>B</mi></mrow></math></td>
<td align="left">A %dblup% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⇑</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">A == B</td>
<td align="left"><math><mrow><mi>A</mi><mo>=</mo><mi>B</mi></mrow></math></td>
<td align="left">crossprod(A, B)</td>
<td align="left"><math><mrow><msup><mi>A</mi><mtext>T</mtext></msup><mo>×</mo><mi>B</mi></mrow></math></td>
<td align="left">A %dbldown% B</td>
<td align="left"><math><mrow><mi>A</mi><mo>⇓</mo><mi>B</mi></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">A &lt;- B</td>
<td align="left"><math><mrow><mi>A</mi><mo>=</mo><mi>B</mi></mrow></math></td>
<td align="left">is.null(A)</td>
<td align="left"><math><mrow><mi>A</mi><mo>=</mo><mi>∅</mi></mrow></math></td>
<td align="left"></td>
<td align="left"><math><mtext></mtext></math></td>
</tr>
</tbody>
</table>
</div>
<div id="builtin-functions" class="section level2">
<h2>Builtin functions</h2>
<p>There is support for most functions from package <em>base</em>, with
adequate use and omission of parentheses.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">sin</span>(x) <span class="sc">+</span> <span class="fu">sin</span>(x)<span class="sc">^</span>2L <span class="sc">+</span> <span class="fu">cos</span>(pi<span class="sc">/</span>2L) <span class="sc">+</span> <span class="fu">tan</span>(2L<span class="sc">*</span>pi) <span class="sc">*</span> <span class="fu">expm1</span>(x))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mrow><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow><mo>+</mo><mrow><msup><mi>sin</mi><mn>2</mn></msup><mo>⁡</mo><mi>x</mi></mrow></mrow><mo>+</mo><mrow><mi>cos</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>π</mi><mo>/</mo><mn>2</mn></mrow><mo>)</mo></mrow></mrow></mrow><mo>+</mo><mrow><mrow><mi>tan</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mn>2</mn><mo>⁢</mo><mi>π</mi></mrow><mo>)</mo></mrow></mrow><mo>⋅</mo><mrow><mo>(</mo><mrow><mrow><mi>exp</mi><mo>⁡</mo><mi>x</mi></mrow><mo>-</mo><mn>1</mn></mrow><mo>)</mo></mrow></mrow></mrow></math></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">choose</span>(N, k) <span class="sc">+</span> <span class="fu">abs</span>(x) <span class="sc">+</span> <span class="fu">sqrt</span>(x) <span class="sc">+</span> <span class="fu">floor</span>(x) <span class="sc">+</span> <span class="fu">ceiling</span>(x))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mrow><mrow><mrow><mo>(</mo><mfrac linethickness="0"><mi>N</mi><mi>k</mi></mfrac><mo>)</mo></mrow><mo>+</mo><mrow><mo>|</mo><mi>x</mi><mo>|</mo></mrow></mrow><mo>+</mo><msqrt><mi>x</mi></msqrt></mrow><mo>+</mo><mrow><mo>⌊</mo><mi>x</mi><mo>⌋</mo></mrow></mrow><mo>+</mo><mrow><mo>⌈</mo><mi>x</mi><mo>⌉</mo></mrow></mrow></math></p>
<p>A few more examples are shown in Table 2, including functions from
<em>stats</em>.</p>
<table>
<caption>Table 2. R functions from base and stats</caption>
<colgroup>
<col width="2%" />
<col width="26%" />
<col width="4%" />
<col width="66%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Output</th>
<th align="left">Function</th>
<th align="left">Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sin(x)</td>
<td align="left"><math><mrow><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow></math></td>
<td align="left">dbinom(k, N, pi)</td>
<td align="left"><math><mrow><msub><mi>P</mi><mtext>Bi</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>=</mo><mi>k</mi></mrow><mo>;</mo><mrow><mi>N</mi><mo>,</mo><mi>π</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">cosh(x)</td>
<td align="left"><math><mrow><mi>cosh</mi><mo>⁡</mo><mi>x</mi></mrow></math></td>
<td align="left">pbinom(k, N, pi)</td>
<td align="left"><math><mrow><msub><mi>P</mi><mtext>Bi</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>k</mi></mrow><mo>;</mo><mrow><mi>N</mi><mo>,</mo><mi>π</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">tanpi(alpha)</td>
<td align="left"><math><mrow><mi>tan</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>α</mi><mo>⁢</mo><mi>π</mi></mrow><mo>)</mo></mrow></mrow></math></td>
<td align="left">qbinom(p, N, pi)</td>
<td align="left"><math><mrow><msub><mi>argmin</mi><mi>k</mi></msub><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><msub><mi>P</mi><mtext>Bi</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>k</mi></mrow><mo>;</mo><mrow><mi>N</mi><mo>,</mo><mi>π</mi></mrow></mrow><mo>)</mo></mrow></mrow><mo>&gt;</mo><mi>p</mi></mrow><mo>]</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">asinh(alpha)</td>
<td align="left"><math><mrow><msup><mi>sinh</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>⁡</mo><mi>α</mi></mrow></math></td>
<td align="left">dpois(k, lambda)</td>
<td align="left"><math><mrow><msub><mi>P</mi><mtext>Po</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>=</mo><mi>k</mi></mrow><mo>;</mo><mi>λ</mi></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">log(p)</td>
<td align="left"><math><mrow><mi>log</mi><mo>⁡</mo><mi>p</mi></mrow></math></td>
<td align="left">ppois(k, lambda)</td>
<td align="left"><math><mrow><msub><mi>P</mi><mtext>Po</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>k</mi></mrow><mo>;</mo><mi>λ</mi></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">log1p(x)</td>
<td align="left"><math><mrow><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>+</mo><mi>x</mi></mrow><mo>)</mo></mrow></mrow></math></td>
<td align="left">qpois(p, lambda)</td>
<td align="left"><math><mrow><msub><mi>argmax</mi><mi>k</mi></msub><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><msub><mi>P</mi><mtext>Po</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>k</mi></mrow><mo>;</mo><mi>λ</mi></mrow><mo>)</mo></mrow></mrow><mo>&gt;</mo><mi>p</mi></mrow><mo>]</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">logb(x, e)</td>
<td align="left"><math><mrow><msub><mi>log</mi><mi>e</mi></msub><mo>⁡</mo><mi>x</mi></mrow></math></td>
<td align="left">dexp(x, lambda)</td>
<td align="left"><math><mrow><msub><mi>f</mi><mtext>Exp</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>x</mi><mo>;</mo><mi>λ</mi></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">exp(x)</td>
<td align="left"><math><mrow><mi>exp</mi><mo>⁡</mo><mi>x</mi></mrow></math></td>
<td align="left">pexp(x, lambda)</td>
<td align="left"><math><mrow><msub><mi>F</mi><mtext>Exp</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>x</mi><mo>;</mo><mi>λ</mi></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">expm1(x)</td>
<td align="left"><math><mrow><mrow><mi>exp</mi><mo>⁡</mo><mi>x</mi></mrow><mo>-</mo><mn>1</mn></mrow></math></td>
<td align="left">qexp(p, lambda)</td>
<td align="left"><math><mrow><msubsup><mi>F</mi><mtext>Exp</mtext><mrow><mo>-</mo><mn>1</mn></mrow></msubsup><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>;</mo><mi>λ</mi></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">choose(n, k)</td>
<td align="left"><math><mrow><mo>(</mo><mfrac linethickness="0"><mi>n</mi><mi>k</mi></mfrac><mo>)</mo></mrow></math></td>
<td align="left">dnorm(x, mu, sigma)</td>
<td align="left"><math><mrow><mi>φ</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>x</mi><mo>;</mo><mrow><mi>μ</mi><mo>,</mo><mi>σ</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">lchoose(n, k)</td>
<td align="left"><math><mrow><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mfrac linethickness="0"><mi>n</mi><mi>k</mi></mfrac><mo>)</mo></mrow></mrow></math></td>
<td align="left">pnorm(x, mu, sigma)</td>
<td align="left"><math><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>x</mi><mo>;</mo><mrow><mi>μ</mi><mo>,</mo><mi>σ</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">factorial(n)</td>
<td align="left"><math><mrow><mi>n</mi><mo>!</mo></mrow></math></td>
<td align="left">qnorm(alpha/2L)</td>
<td align="left"><math><mrow><msup><mi>Φ</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>α</mi><mo>/</mo><mn>2</mn></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">lfactorial(n)</td>
<td align="left"><math><mrow><mi>log</mi><mo>⁡</mo><mrow><mi>n</mi><mo>!</mo></mrow></mrow></math></td>
<td align="left">1L - pchisq(x, 1L)</td>
<td align="left"><math><mrow><mn>1</mn><mo>-</mo><mrow><msub><mi>F</mi><mrow><msup><mi>χ</mi><mn>2</mn></msup><mo>⁡</mo><mrow><mo>(</mo><mrow><mn>1</mn><mspace width="thinmathspace"></mspace><mtext>df</mtext></mrow><mo>)</mo></mrow></mrow></msub><mo>⁡</mo><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">sqrt(x)</td>
<td align="left"><math><msqrt><mi>x</mi></msqrt></math></td>
<td align="left">qchisq(1L - alpha, 1L)</td>
<td align="left"><math><mrow><msubsup><mi>F</mi><mrow><msup><mi>χ</mi><mn>2</mn></msup><mo>⁡</mo><mrow><mo>(</mo><mrow><mn>1</mn><mspace width="thinmathspace"></mspace><mtext>df</mtext></mrow><mo>)</mo></mrow></mrow><mrow><mo>-</mo><mn>1</mn></mrow></msubsup><mo>⁡</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>-</mo><mi>α</mi></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">mean(X)</td>
<td align="left"><math><mover accent="true"><mi>X</mi><mo>¯</mo></mover></math></td>
<td align="left">pt(t, N - 1L)</td>
<td align="left"><math><mrow><mi>P</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>T</mi><mo>≤</mo><mi>t</mi></mrow><mo>;</mo><mrow><mrow><mi>N</mi><mo>-</mo><mn>1</mn></mrow><mspace width="thinmathspace"></mspace><mtext>df</mtext></mrow></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
<tr class="even">
<td align="left">abs(x)</td>
<td align="left"><math><mrow><mo>|</mo><mi>x</mi><mo>|</mo></mrow></math></td>
<td align="left">qt(alpha/2L, N - 1L)</td>
<td align="left"><math><mrow><msub><mi>T</mi><mrow><mi>α</mi><mo>/</mo><mn>2</mn></mrow></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>N</mi><mo>-</mo><mn>1</mn></mrow><mspace width="thinmathspace"></mspace><mtext>df</mtext></mrow><mo>)</mo></mrow></mrow></math></td>
</tr>
</tbody>
</table>
</div>
<div id="custom-functions" class="section level2">
<h2>Custom functions</h2>
<p><strong>this part is incomprehensible for the naive
reader</strong></p>
<p>For self-written functions, matters are a bit more complicated. The
name of a self-written function is not transparent to R, since only the
function body is represented, as illustrated by the redefinition of
<code>sign</code> below. The function body is generally a nested R
“call” of the form <code>&#39;{&#39;(L)</code>, with <code>L</code> being a list
of commands. <em>mathml</em> provides limited support for typical
control structures.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sgn <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">==</span> 0L) <span class="fu">return</span>(0L)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&lt;</span> 0L) <span class="fu">return</span>(<span class="sc">-</span>1L)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&gt;</span> 0L) <span class="fu">return</span>(1L)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(sgn)</span></code></pre></div>
<p><math><mrow><mo>{</mo><mtable columnalign="left"><mrow><mn>0</mn><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow></mrow><mrow><mrow><mo>-</mo><mn>1</mn></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>x</mi><mo>&lt;</mo><mn>0</mn></mrow></mrow><mrow><mn>1</mn><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>x</mi><mo>&gt;</mo><mn>0</mn></mrow></mrow></mtable></mrow></math></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;&lt;-&quot;</span>, <span class="fu">quote</span>(<span class="fu">sgn</span>(x)), sgn))</span></code></pre></div>
<p><math><mrow><mrow><mi>sgn</mi><mo>⁡</mo><mi>x</mi></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnalign="left"><mrow><mn>0</mn><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow></mrow><mrow><mrow><mo>-</mo><mn>1</mn></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>x</mi><mo>&lt;</mo><mn>0</mn></mrow></mrow><mrow><mn>1</mn><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>x</mi><mo>&gt;</mo><mn>0</mn></mrow></mrow></mtable></mrow></mrow></math></p>
<p>As shown above, we can still display functions in the form
<code>head(x) = body</code> if we embed the object to be shown into a
call such as <code>head() &lt;- body</code>.</p>
</div>
<div id="indices-and-powers" class="section level2">
<h2>Indices and powers</h2>
<p>Indices in square brackets are rendered as subscripts, powers are
rendered as superscript. Moreover, <em>mathml</em> defines the functions
<code>subscript()</code>, <code>superscript()</code> and
<code>subsuperscript()</code> that simply return their first argument.
The other arguments serve as decorations, for example, for summation and
product signs.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(S[Y]<span class="sc">^</span>2L <span class="ot">&lt;-</span> <span class="fu">frac</span>(1L, N) <span class="sc">*</span> <span class="fu">sum</span>(Y[i] <span class="sc">-</span> <span class="fu">mean</span>(Y))<span class="sc">^</span>2L)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><msubsup><mi>S</mi><mi>Y</mi><mn>2</mn></msubsup><mo>=</mo><mrow><mfrac><mn>1</mn><mi>N</mi></mfrac><mo>⁢</mo><msup><mrow><mo>∑</mo><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>-</mo><mover accent="true"><mi>Y</mi><mo>¯</mo></mover></mrow><mo>)</mo></mrow></mrow><mn>2</mn></msup></mrow></mrow></math></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">log</span>(<span class="fu">subsupscript</span>(<span class="fu">prod</span>(L[i]), i<span class="sc">==</span>1L, N)) <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">subsupscript</span>(<span class="fu">sum</span>(<span class="fu">log</span>(L[i])), i<span class="sc">==</span>1L, N))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mrow><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mo>⁡</mo><msub><mi>L</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow></mrow><mo>=</mo><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mo>⁡</mo><mrow><mi>log</mi><mo>⁡</mo><msub><mi>L</mi><mi>i</mi></msub></mrow></mrow></mrow></math></p>
</div>
<div id="ringing-back-to-r" class="section level2">
<h2>Ringing back to R</h2>
<p>R&#39;s <code>integrate</code> function takes a number of arguments, the
most important ones being the function to integrate, and the lower and
the upper bound of the integration.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">integrate</span>(sin, 0L, 2L<span class="sc">*</span>pi))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><munderover><mo>∫</mo><mn>0</mn><mrow><mn>2</mn><mo>⁢</mo><mi>π</mi></mrow></munderover><mrow><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow><mspace width="thinmathspace"></mspace><mi>d</mi><mi>x</mi></mrow></math></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(term)</span></code></pre></div>
<p>2.221501e-16 with absolute error &lt; 4.4e-14</p>
<p>For mathematical typesetting in the form of <span class="math inline">\(\int f(x)\, dx\)</span>, <em>mathml</em> needs to
find out the name of the integration variable. For that purpose, the
underlying Prolog bridge provides a predicate <code>r_eval/2</code> that
calls R from Prolog. In the example above, this predicate evaluates
<code>formalArgs(args(sin))</code>, which returns the names of the
arguments of <code>sin</code>, namely, <code>x</code>.</p>
<p>Note that in the example above, the quoted term is an abbreviation
for <code>call(&quot;integrate&quot;, quote(sin), ...)</code>, with
<code>sin</code> being an R symbol, not a function. R’s
<code>integrate()</code> can handle both. However, as already mentioned
in the previous subsection, <em>mathml</em> would be unable to find out
the function name, it needs the symbol.</p>
</div>
<div id="names-and-order-of-arguments" class="section level2">
<h2>Names and order of arguments</h2>
<p>One of R’s great features is the possibility to refer to function
arguments by their names, not only by their position in the list of
arguments. At the other end, most Prolog-powered handlers for the
R calls are rather rigid, for example, <code>integrate/3</code> accepts
exactly three arguments in a particular order and without names, that
is, <code>integrate(lower=0L, upper=2L*pi, sin)</code>, would not print
the desired result.</p>
<p>To “canonicalize” function calls with named arguments and arguments
in unusual order, <em>mathml</em> provides an auxilliary R function
<code>canonical(f, drop)</code> that reorders the argument list of calls
to known R functions and, if <code>drop=TRUE</code> (which is the
default), also removes the names of the arguments.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">integrate</span>(<span class="at">lower=</span>0L, <span class="at">upper=</span>2L<span class="sc">*</span>pi, sin))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">canonical</span>(term)</span></code></pre></div>
<pre><code>## integrate(sin, 0L, 2L * pi)</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">canonical</span>(term))</span></code></pre></div>
<p><math><mrow><munderover><mo>∫</mo><mn>0</mn><mrow><mn>2</mn><mo>⁢</mo><mi>π</mi></mrow></munderover><mrow><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow><mspace width="thinmathspace"></mspace><mi>d</mi><mi>x</mi></mrow></math></p>
<p>This function can be used to feed mixtures of partially named and
positional arguments into the renderer. For details, see the R function
<code>match.call()</code>.</p>
</div>
<div id="matrices-and-vectors" class="section level2">
<h2>Matrices and Vectors</h2>
<p>Of course, <em>mathml</em> also supports matrices and vectors.</p>
<p>No, sorry, it doesn’t right now, please wait for rolog-0.9.12.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># v &lt;- 1:3</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mathout(call(&quot;t&quot;, v))</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A &lt;- matrix(data=11:16, nrow=2, ncol=3)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># B &lt;- matrix(data=21:26, nrow=2, ncol=3)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># term &lt;- call(&quot;+&quot;, A, B)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># mathout(term)</span></span></code></pre></div>
<p>Note that the seemingly more convient
<code>term &lt;- quote(A + B)</code> yields <span class="math inline">\(A + B\)</span> in the output—instead of the
desired matrix representation.</p>
</div>
<div id="abbreviations" class="section level2">
<h2>Abbreviations</h2>
<p>We consider the <span class="math inline">\(t\)</span>-statistic for
independent samples with equal variance. To avoid clutter in the
equation, the pooled variance <span class="math inline">\(s^2_{\mathrm{pool}}\)</span> is abbreviated, and a
comment is given with the expression for <span class="math inline">\(s^2_{\mathrm{pool}}\)</span>. For this purpose,
<em>mathml</em> provides a function
<code>denote(abbr, expr, info)</code>, with <code>expr</code> actually
being evaluated, <code>abbr</code> being rendered, plus a comment of the
form “with <code>expr</code> denoting <code>info</code>”. The hooks are
described in the next section.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(m_A, <span class="fu">mean</span>(X)[<span class="st">&quot;A&quot;</span>]) ; <span class="fu">hook</span>(s2_A, s[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L) ;</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(n_A, n[<span class="st">&quot;A&quot;</span>])</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(m_B, <span class="fu">mean</span>(X)[<span class="st">&quot;B&quot;</span>]) ; <span class="fu">hook</span>(s2_B, s[<span class="st">&quot;B&quot;</span>]<span class="sc">^</span>2L)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(n_B, n[<span class="st">&quot;B&quot;</span>]) ; <span class="fu">hook</span>(s2_p, s[<span class="st">&quot;pool&quot;</span>]<span class="sc">^</span>2L)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(t <span class="ot">&lt;-</span> <span class="fu">dfrac</span>(m_A <span class="sc">-</span> m_B, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">denote</span>(s2_p, <span class="fu">frac</span>((n_A <span class="sc">-</span> 1L)<span class="sc">*</span>s2_A <span class="sc">+</span> (n_B <span class="sc">-</span> 1L)<span class="sc">*</span>s2_B, n_A <span class="sc">+</span> n_B <span class="sc">-</span> 2L),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;the pooled variance.&quot;</span>) <span class="sc">*</span> (<span class="fu">frac</span>(1L, n_A) <span class="sc">+</span> <span class="fu">frac</span>(1L, n_B)))))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><mi>t</mi><mo>=</mo><mstyle displaystyle="true"><mfrac><mrow><msub><mover accent="true"><mi>X</mi><mo>¯</mo></mover><mtext>A</mtext></msub><mo>-</mo><msub><mover accent="true"><mi>X</mi><mo>¯</mo></mover><mtext>B</mtext></msub></mrow><msqrt><mrow><msubsup><mi>s</mi><mtext>pool</mtext><mn>2</mn></msubsup><mo>⋅</mo><mrow><mo>(</mo><mrow><mfrac><mn>1</mn><msub><mi>n</mi><mtext>A</mtext></msub></mfrac><mo>+</mo><mfrac><mn>1</mn><msub><mi>n</mi><mtext>B</mtext></msub></mfrac></mrow><mo>)</mo></mrow></mrow></msqrt></mfrac></mstyle></mrow></math><span>,
with <span><math><mrow><msubsup><mi>s</mi><mtext>pool</mtext><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><mrow><mrow><mo>(</mo><mrow><msub><mi>n</mi><mtext>A</mtext></msub><mo>-</mo><mn>1</mn></mrow><mo>)</mo></mrow><mo>⋅</mo><msubsup><mi>s</mi><mtext>A</mtext><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>n</mi><mtext>B</mtext></msub><mo>-</mo><mn>1</mn></mrow><mo>)</mo></mrow><mo>⋅</mo><msubsup><mi>s</mi><mtext>B</mtext><mn>2</mn></msubsup></mrow></mrow><mrow><mrow><msub><mi>n</mi><mtext>A</mtext></msub><mo>+</mo><msub><mi>n</mi><mtext>B</mtext></msub></mrow><mo>-</mo><mn>2</mn></mrow></mfrac></mrow></math>
denoting the pooled variance.</span></span></p>
<p>The term is evaluated below. <code>print()</code> is needed because
the return value of the assignment in the term
<code>t &lt;- dfrac(...)</code> is invisible.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>m_A <span class="ot">&lt;-</span> <span class="fl">1.5</span>; s2_A <span class="ot">&lt;-</span> <span class="fl">2.4</span><span class="sc">^</span><span class="dv">2</span>; n_A <span class="ot">&lt;-</span> <span class="dv">27</span>; m_B <span class="ot">&lt;-</span> <span class="fl">3.9</span>; s2_B <span class="ot">&lt;-</span> <span class="fl">2.8</span><span class="sc">^</span><span class="dv">2</span>; n_B <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">eval</span>(term))</span></code></pre></div>
<pre><code>## [1] -3.157427</code></pre>
</div>
<div id="context-dependent-rendering" class="section level2">
<h2>Context-dependent rendering</h2>
<p>Consider an educational scenario in which we want to highlight a
certain element of a term, for example, that a student has forgotten to
subtract the null hypothesis in a <span class="math inline">\(t\)</span>-ratio:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">dfrac</span>(<span class="fu">omit_right</span>(<span class="fu">mean</span>(D) <span class="sc">-</span> mu[0L]), s <span class="sc">/</span> <span class="fu">sqrt</span>(N)))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(t, <span class="at">flags=</span><span class="fu">list</span>(<span class="at">error=</span><span class="st">&#39;highlight&#39;</span>))</span></code></pre></div>
<p><math><mstyle displaystyle="true"><mfrac><mrow><mover accent="true"><mi>D</mi><mo>¯</mo></mover><mspace width="thinmathspace"></mspace><menclose notation="updiagonalstrike"><mrow><mo>-</mo><mspace width="thinmathspace"></mspace><msub><mi>μ</mi><mn>0</mn></msub></mrow></menclose></mrow><mrow><mi>s</mi><mo>/</mo><msqrt><mi>N</mi></msqrt></mrow></mfrac></mstyle></math></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(t, <span class="at">flags=</span><span class="fu">list</span>(<span class="at">error=</span><span class="st">&#39;fix&#39;</span>))</span></code></pre></div>
<p><math><mstyle displaystyle="true"><mfrac><mrow><mover accent="true"><mi>D</mi><mo>¯</mo></mover><mspace width="thinmathspace"></mspace><menclose notation="roundedbox"><mrow><mo>-</mo><mspace width="thinmathspace"></mspace><msub><mi>μ</mi><mn>0</mn></msub></mrow></menclose></mrow><mrow><mi>s</mi><mo>/</mo><msqrt><mi>N</mi></msqrt></mrow></mfrac></mstyle></math></p>
<p>The R function <code>omit_right(a + b)</code> uses non-standard
evaluation techniques <span class="citation">(e.g., Wickham 2019)</span>
to return only the left part an operation, and cancels the right part.
This may not always be desired, for example, when illustrating how to
fix the mistake.</p>
<p>For this purpose, the functions <code>mathml()</code> or
<code>mathjax()</code> have an optional argument <code>flags</code>
which is a list with named elements. In this example, we use this
argument to tell <em>mathml</em> how to render such erroneous
expressions using the flag <code>error</code> which can be asis,
highlight, fix, or ignore. For more examples, see Table 3.</p>
<table>
<caption>Table 3. Highlighting elements of a term</caption>
<colgroup>
<col width="4%" />
<col width="14%" />
<col width="36%" />
<col width="30%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Operation</th>
<th align="left">error = asis</th>
<th align="left">highlight</th>
<th align="left">fix</th>
<th align="left">ignore</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">omit_left(a + b)</td>
<td align="left"><math><mi>b</mi></math></td>
<td align="left"><math><mrow><menclose notation="updiagonalstrike"><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mo>+</mo></mrow></menclose><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></math></td>
<td align="left"><math><mrow><menclose notation="roundedbox"><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mo>+</mo></mrow></menclose><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">omit_right(a + b)</td>
<td align="left"><math><mi>a</mi></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="updiagonalstrike"><mrow><mo>+</mo><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="roundedbox"><mrow><mo>+</mo><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">list(quote(a), quote(omit(b)))</td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mtext></mtext></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="updiagonalstrike"><mi>b</mi></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="roundedbox"><mi>b</mi></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></math></td>
</tr>
<tr class="even">
<td align="left">add_left(a + b)</td>
<td align="left"><math><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow></math></td>
<td align="left"><math><mrow><menclose notation="roundedbox"><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mo>+</mo></mrow></menclose><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></math></td>
<td align="left"><math><mrow><menclose notation="updiagonalstrike"><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mo>+</mo></mrow></menclose><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></math></td>
<td align="left"><math><mi>b</mi></math></td>
</tr>
<tr class="odd">
<td align="left">add_right(a + b)</td>
<td align="left"><math><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="roundedbox"><mrow><mo>+</mo><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="updiagonalstrike"><mrow><mo>+</mo><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></menclose></mrow></math></td>
<td align="left"><math><mi>a</mi></math></td>
</tr>
<tr class="even">
<td align="left">list(quote(a), quote(add(b)))</td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="roundedbox"><mi>b</mi></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><menclose notation="updiagonalstrike"><mi>b</mi></menclose></mrow></math></td>
<td align="left"><math><mrow><mi>a</mi><mspace width="thinmathspace"></mspace><mtext></mtext></mrow></math></td>
</tr>
<tr class="odd">
<td align="left">instead(a, b) + c</td>
<td align="left"><math><mrow><mi>a</mi><mo>+</mo><mi>c</mi></mrow></math></td>
<td align="left"><math><mrow><munder><munder accentunder="true"><mi>a</mi><mo stretchy="true">⏟</mo></munder><mrow><mtext>instead
of</mtext><mspace width="thinmathspace"></mspace><mi>b</mi></mrow></munder><mo>+</mo><mi>c</mi></mrow></math></td>
<td align="left"><math><mrow><menclose notation="roundedbox"><mi>b</mi></menclose><mo>+</mo><mi>c</mi></mrow></math></td>
<td align="left"><math><mrow><mi>b</mi><mo>+</mo><mi>c</mi></mrow></math></td>
</tr>
</tbody>
</table>
</div>
<div id="customizing-the-package" class="section level2">
<h2>Customizing the package</h2>
<p>In typical R functions, variable names are typically longer than just
single letters, which may yield unsatisfactory results in the
mathematical output.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">quote</span>(<span class="fu">pbinom</span>(successes, Ntotal, prob))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><msub><mi>P</mi><mtext>Bi</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>successes</mi></mrow><mo>;</mo><mrow><mi>Ntotal</mi><mo>,</mo><mi>prob</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(successes, k)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(<span class="fu">quote</span>(Ntotal), <span class="fu">quote</span>(N), <span class="at">quote=</span><span class="cn">FALSE</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(prob, pi)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(term)</span></code></pre></div>
<p><math><mrow><msub><mi>P</mi><mtext>Bi</mtext></msub><mo>⁡</mo><mrow><mo>(</mo><mrow><mrow><mi>X</mi><mo>≤</mo><mi>k</mi></mrow><mo>;</mo><mrow><mi>N</mi><mo>,</mo><mi>π</mi></mrow></mrow><mo>)</mo></mrow></mrow></math></p>
<p>To improve the situation, <em>mathml</em> provides a simple hook that
can be used to replace elements (e.g., verbose variable names) of the
code by concise mathematical symbols, as illustrated in the example. To
simplify notation, the <code>quote</code> flag of <code>hook()</code>
defaults to TRUE, and <code>hook()</code> uses non-standard evaluation
to unpack its arguments. If quote is FALSE, as shown above, the user has
to provide the quoted expressions. Care should be taken to avoid
recursive hooks such as <code>hook(s, s[&quot;A&quot;])</code> that endlessly
replace the <span class="math inline">\(s\)</span> from <span class="math inline">\(s_{\mathrm{A}}\)</span> as in <span class="math inline">\(s_{\mathrm{A}_{\mathrm{A}_{\mathrm{A}\cdots}}}\)</span>.</p>
<p>Further customizations require the assertion of custom Prolog rules
<code>math/2</code>, <code>ml/3</code>, <code>jax/3</code>, as shown in
the introduction.</p>
</div>
</div>
<div id="case-study" class="section level1">
<h1>A case study</h1>
<p>This case study describes a model by Schwarz <span class="citation">(1994)</span> from mathematical Psychology using the
features of package <em>mathml</em>. Schwarz presents a new explanation
of redundancy gains that occur when observers respond to stimuli of
different sources, and the same information is presented on two or more
channels. In Schwarz’ model, decision-making builds on a process of
noisy accumulation of information over time <span class="citation">(e.g., Ratcliff et al. 2016)</span>. In redundant
stimuli, the model assumes a superposition of channel-specific diffusion
processes that eventually reach an absorbing barrier to elicit the
response. For a detailed description the reader may refer to the
original article.</p>
<p>Schwarz’ <span class="citation">(1994)</span> model refers to two
stimuli A and B, presented either alone or in combination (AB, redundant
stimuli), with the redundant stimuli being presented either
simultaneously or with onset asynchrony <span class="math inline">\(\tau\)</span>. The channel activation is described
as a two-dimensional Wiener process with drifts <span class="math inline">\(\mu_i\)</span>, variances <span class="math inline">\(\sigma^2_i\)</span>, and initial conditions <span class="math inline">\(X_i(t = 0) = 0, i = \mathrm{A, B}\)</span>. The
channels may be correlated with <span class="math inline">\(\rho_{\mathrm{AB}}\)</span>, but we assume <span class="math inline">\(\rho_{\mathrm{AB}} = 0\)</span> for
simplicity.</p>
<p>A response is elicited when the process reaches an absorbing barrier
<span class="math inline">\(c &gt; 0\)</span> for the first time. In
single-target trials, the first passages at <span class="math inline">\(c\)</span> are expected at</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ED_single <span class="ot">&lt;-</span> <span class="cf">function</span>(c, mu)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfrac</span>(c, mu)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display as E(D; mu), c is a scaling parameter</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(<span class="fu">ED_single</span>(.C, .Mu), <span class="fu">E</span>(<span class="st">`</span><span class="at">;</span><span class="st">`</span>(D, .Mu)))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(<span class="fu">ED_single</span>(c, mu)), ED_single))</span></code></pre></div>
<p><math><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>D</mi><mo>;</mo><mi>μ</mi></mrow><mo>)</mo></mrow></mrow><mo>=</mo><mstyle displaystyle="true"><mfrac><mi>c</mi><mi>μ</mi></mfrac></mstyle></mrow></math></p>
<p>In redundant stimuli, the activation of the channel-specific
diffusion processes adds up, <span class="math inline">\(X_{\mathrm{AB}}(t) = X_{\mathrm A}(t) + X_{\mathrm
B}(t)\)</span>, hence the name, superposition. <span class="math inline">\(X_{\mathrm{AB}}(t)\)</span> is again a Wiener
process with drift <span class="math inline">\(\mu_{\mathrm A} +
\mu_{\mathrm B}\)</span> and variance <span class="math inline">\(\sigma^2_{\mathrm A} + \sigma^2_{\mathrm
B}\)</span>. For the expected first-passage time, we have</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(mu_A, mu[<span class="st">&quot;A&quot;</span>])</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(mu_B, mu[<span class="st">&quot;B&quot;</span>])</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(sigma_A, sigma[<span class="st">&quot;A&quot;</span>])</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(sigma_B, sigma[<span class="st">&quot;B&quot;</span>])</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(mu_M, mu[<span class="st">&quot;M&quot;</span>])</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(M, <span class="fu">overline</span>(X))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(<span class="fu">E</span>(D[<span class="st">&quot;AB&quot;</span>])), <span class="fu">quote</span>(<span class="fu">ED_single</span>(c, mu_A <span class="sc">+</span> mu_B))))</span></code></pre></div>
<p><math><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><msub><mi>D</mi><mtext>AB</mtext></msub><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>D</mi><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>+</mo><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow></mrow></math></p>
<p>For asynchronous stimuli, Schwarz [-<span class="citation">Schwarz
(1994)</span>; Eq. 10] derived the expected first-passage time as a
function of the stimulus onset asyncrony <span class="math inline">\(\tau\)</span>,</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ED_async <span class="ot">&lt;-</span> <span class="cf">function</span>(tau, c, mu_A, sigma_A, mu_B)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>{ <span class="fu">dfrac</span>(c, mu_A) <span class="sc">+</span> (<span class="fu">dfrac</span>(1L, mu_A) <span class="sc">-</span> <span class="fu">dfrac</span>(1L, mu_A <span class="sc">+</span> mu_B)) <span class="sc">*</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    ((mu_A<span class="sc">*</span>tau <span class="sc">-</span> c) <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">dfrac</span>(c <span class="sc">-</span> mu_A<span class="sc">*</span>tau, <span class="fu">sqrt</span>(sigma_A<span class="sc">^</span>2L<span class="sc">*</span>tau)))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> (mu_A<span class="sc">*</span>tau <span class="sc">+</span> c) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">dfrac</span>(2L<span class="sc">*</span>c<span class="sc">*</span>mu_A, sigma_A<span class="sc">^</span>2L))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">dfrac</span>(<span class="sc">-</span>c <span class="sc">-</span> mu_A<span class="sc">*</span>tau, <span class="fu">sqrt</span>(sigma_A<span class="sc">^</span>2L<span class="sc">*</span>tau))))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(<span class="fu">ED_async</span>(.Tau, .C, .MA, .SA, .MB), <span class="fu">E</span>(<span class="st">`</span><span class="at">;</span><span class="st">`</span>(D[.Tau], <span class="st">`</span><span class="at">,</span><span class="st">`</span>(.MA, .SA, .MB))))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(<span class="fu">ED_async</span>(tau, c, mu_A, sigma_A, mu_B)), ED_async))</span></code></pre></div>
<p><math><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>D</mi><mi>τ</mi></msub><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mstyle displaystyle="true"><mfrac><mi>c</mi><msub><mi>μ</mi><mtext>A</mtext></msub></mfrac></mstyle><mo>+</mo><mrow><mrow><mo>(</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><msub><mi>μ</mi><mtext>A</mtext></msub></mfrac></mstyle><mo>-</mo><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>+</mo><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mfrac></mstyle></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>[</mo><mrow><mrow><mrow><mo>(</mo><mrow><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow><mo>-</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi>c</mi><mo>-</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow></mrow><msqrt><mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup><mo>⁢</mo><mi>τ</mi></mrow></msqrt></mfrac></mstyle><mo>)</mo></mrow></mrow></mrow><mo>-</mo><mrow><mrow><mrow><mo>(</mo><mrow><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow><mo>+</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mi>exp</mi><mo>⁡</mo><mstyle displaystyle="true"><mfrac><mrow><mrow><mn>2</mn><mo>⁢</mo><mi>c</mi></mrow><mo>⁢</mo><msub><mi>μ</mi><mtext>A</mtext></msub></mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup></mfrac></mstyle></mrow></mrow><mo>⋅</mo><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mrow><mo>-</mo><mi>c</mi></mrow><mo>-</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow></mrow><msqrt><mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup><mo>⁢</mo><mi>τ</mi></mrow></msqrt></mfrac></mstyle><mo>)</mo></mrow></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow></mrow></math></p>
<p>For negative onset asynchrony (i.e., B before A), the parameters need
to be switched.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ED <span class="ot">&lt;-</span> <span class="cf">function</span>(tau, c, mu_A, sigma_A, mu_B, sigma_B)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tau <span class="sc">==</span> <span class="cn">Inf</span>) <span class="fu">return</span>(<span class="fu">ED_single</span>(c, mu_A)) ;</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tau <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>) <span class="fu">return</span>(<span class="fu">ED_single</span>(c, mu_B)) ;</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tau <span class="sc">==</span> 0L) <span class="fu">return</span>(<span class="fu">ED_single</span>(c, mu_A <span class="sc">+</span> mu_B)) ;</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tau <span class="sc">&gt;</span> 0L) <span class="fu">return</span>(<span class="fu">ED_async</span>(tau, c, mu_A, sigma_A, mu_B)) ;</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tau <span class="sc">&lt;</span> 0L) <span class="fu">return</span>(<span class="fu">ED_async</span>(<span class="fu">abs</span>(tau), c, mu_B, sigma_B, mu_A))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(<span class="fu">ED</span>(.Tau, .C, .MA, .SA, .MB, .SB), <span class="fu">E</span>(<span class="st">`</span><span class="at">;</span><span class="st">`</span>(D[.Tau], <span class="st">`</span><span class="at">,</span><span class="st">`</span>(.MA, .SA, .MB, .SB))))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(<span class="fu">ED</span>(tau, c, mu_A, sigma_A, mu_B, sigma_B)), ED))</span></code></pre></div>
<p><math><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>D</mi><mi>τ</mi></msub><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>B</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>B</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnalign="left"><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>D</mi><mo>;</mo><msub><mi>μ</mi><mtext>A</mtext></msub></mrow><mo>)</mo></mrow></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>τ</mi><mo>=</mo><mi>∞</mi></mrow></mrow><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>D</mi><mo>;</mo><msub><mi>μ</mi><mtext>B</mtext></msub></mrow><mo>)</mo></mrow></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>τ</mi><mo>=</mo><mrow><mo>-</mo><mi>∞</mi></mrow></mrow></mrow><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mi>D</mi><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>+</mo><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>τ</mi><mo>=</mo><mn>0</mn></mrow></mrow><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>D</mi><mi>τ</mi></msub><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>τ</mi><mo>&gt;</mo><mn>0</mn></mrow></mrow><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>D</mi><mrow><mo>|</mo><mi>τ</mi><mo>|</mo></mrow></msub><mo>;</mo><mrow><msub><mi>μ</mi><mtext>B</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>B</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>A</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow><mtext>,</mtext><mspace width="thinmathspace"></mspace><mtext>if</mtext><mspace width="thinmathspace"></mspace><mrow><mi>τ</mi><mo>&lt;</mo><mn>0</mn></mrow></mrow></mtable></mrow></mrow></math></p>
<p>The observable response time is assumed to be the sum of <span class="math inline">\(D\)</span>, the time employed to reach the
threshold for the decision, and a residual <span class="math inline">\(M\)</span> denoting other processes such a motor
preparation and execution. Correspondingly, the expected response time
amounts to</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ET <span class="ot">&lt;-</span> <span class="cf">function</span>(tau, c, mu_A, sigma_A, mu_B, sigma_B, mu_M)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ED</span>(tau, c, mu_A, sigma_A, mu_B, sigma_B) <span class="sc">+</span> mu_M</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(<span class="fu">ET</span>(.Tau, .C, .MA, .SA, .MB, .SB, .MM), </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">E</span>(<span class="st">`</span><span class="at">;</span><span class="st">`</span>(T[.Tau], <span class="st">`</span><span class="at">,</span><span class="st">`</span>(.MA, .SA, .MB, .SB, .MM))))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(<span class="fu">E</span>(T[tau])), ET))</span></code></pre></div>
<p><math><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><msub><mi>T</mi><mi>τ</mi></msub><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>D</mi><mi>τ</mi></msub><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>B</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>B</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow><mo>+</mo><msub><mi>μ</mi><mtext>M</mtext></msub></mrow></mrow></math></p>
<p>Schwarz <span class="citation">(1994)</span> applied the model to
data from a redundant signals task with 13 onset asynchronies <span class="math inline">\(0, \pm33, \pm67, \pm100, \pm133, \pm167,
\pm\infty\)</span> ms, where <span class="math inline">\(0\)</span>
refers to the synchronous condition, and <span class="math inline">\(\pm\infty\)</span> to the single-target
presentations. Each condition was replicated 400 times. The observed
mean response times and their standard deviations are given in Table 4
below.</p>
<table>
<caption>Table 4. Miller data</caption>
<colgroup>
<col width="41%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><span class="math inline">\(\tau\)</span></th>
<th align="left"><span class="math inline">\(m\)</span></th>
<th align="left"><span class="math inline">\(s\)</span></th>
<th align="left"><span class="math inline">\(n\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><math><mrow><mo>-</mo><mi>∞</mi></mrow></math></td>
<td align="left"><math><mn>231</mn></math></td>
<td align="left"><math><mn>56</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><mrow><mo>-</mo><mn>167</mn></mrow></math></td>
<td align="left"><math><mn>234</mn></math></td>
<td align="left"><math><mn>58</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><mrow><mo>-</mo><mn>133</mn></mrow></math></td>
<td align="left"><math><mn>230</mn></math></td>
<td align="left"><math><mn>40</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><mrow><mo>-</mo><mn>100</mn></mrow></math></td>
<td align="left"><math><mn>227</mn></math></td>
<td align="left"><math><mn>40</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><mrow><mo>-</mo><mn>67</mn></mrow></math></td>
<td align="left"><math><mn>228</mn></math></td>
<td align="left"><math><mn>32</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><mrow><mo>-</mo><mn>33</mn></mrow></math></td>
<td align="left"><math><mn>221</mn></math></td>
<td align="left"><math><mn>28</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><mn>0</mn></math></td>
<td align="left"><math><mn>217</mn></math></td>
<td align="left"><math><mn>28</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><mn>33</mn></math></td>
<td align="left"><math><mn>238</mn></math></td>
<td align="left"><math><mn>28</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><mn>67</mn></math></td>
<td align="left"><math><mn>263</mn></math></td>
<td align="left"><math><mn>26</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><mn>100</mn></math></td>
<td align="left"><math><mn>277</mn></math></td>
<td align="left"><math><mn>30</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><mn>133</mn></math></td>
<td align="left"><math><mn>298</mn></math></td>
<td align="left"><math><mn>32</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><mn>167</mn></math></td>
<td align="left"><math><mn>316</mn></math></td>
<td align="left"><math><mn>34</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><mi>∞</mi></math></td>
<td align="left"><math><mn>348</mn></math></td>
<td align="left"><math><mn>92</mn></math></td>
<td align="left"><math><mn>400</mn></math></td>
</tr>
</tbody>
</table>
<p>Assuming that the model is correct, the observable mean reaction
times follow an approximate Normal distribution around the model
prediction <span class="math inline">\(E(T)\)</span>. We can, therefore,
use a standard goodness-of-fit measure by <span class="math inline">\(z\)</span>-standardisation.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="cf">function</span>(m, s, n, tau, c, mu_A, sigma_A, mu_B, sigma_B, mu_M)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfrac</span>(m <span class="sc">-</span> <span class="fu">denote</span>(E, <span class="fu">ET</span>(tau, c, mu_A, sigma_A, mu_B, sigma_B, mu_M),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;the expected mean response time&quot;</span>),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    s <span class="sc">/</span> <span class="fu">sqrt</span>(n))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(z[tau]), z))</span></code></pre></div>
<p><math><mrow><msub><mi>z</mi><mi>τ</mi></msub><mo>=</mo><mstyle displaystyle="true"><mfrac><mrow><mi>m</mi><mo>-</mo><mi>E</mi></mrow><mrow><mi>s</mi><mo>/</mo><msqrt><mi>n</mi></msqrt></mrow></mfrac></mstyle></mrow></math><span>,
with <span><math><mrow><mi>E</mi><mo>=</mo><mrow><mi>E</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><msub><mi>T</mi><mi>τ</mi></msub><mo>;</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>A</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>B</mtext></msub><mi>,</mi><msub><mi>σ</mi><mtext>B</mtext></msub><mi>,</mi><msub><mi>μ</mi><mtext>M</mtext></msub></mrow></mrow><mo>)</mo></mrow></mrow></mrow></math>
denoting the expected mean response time</span></span></p>
<p>The overall goodness-of-fit is the sum of the squared <span class="math inline">\(z\)</span>-statistics for each onset asynchrony.
Assuming again that the architecture of the model is correct, but the
parameters are adjusted to the data, it follows a <span class="math inline">\(\chi^2(8~\mathrm{df})\)</span>-distribution.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>zv <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(z, <span class="at">vectorize.args =</span> <span class="fu">c</span>(<span class="st">&#39;m&#39;</span>, <span class="st">&#39;s&#39;</span>, <span class="st">&#39;n&#39;</span>, <span class="st">&#39;tau&#39;</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>gof <span class="ot">&lt;-</span> <span class="cf">function</span>(par, tau, m, s, n)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">zv</span>(m, s, n, tau, <span class="at">c=</span>100L, <span class="at">mu_A=</span>par[<span class="st">&quot;mu_A&quot;</span>], <span class="at">sigma_A=</span>par[<span class="st">&quot;sigma_A&quot;</span>], </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu_B=</span>par[<span class="st">&quot;mu_B&quot;</span>], <span class="at">sigma_B=</span>par[<span class="st">&quot;sigma_B&quot;</span>], <span class="at">mu_M=</span>par[<span class="st">&quot;mu_M&quot;</span>])<span class="sc">^</span>2L)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hook</span>(<span class="fu">zv</span>(.M, .S, .N, .Tau, .C, .MA, .SA, .MB, .SB, .MM), z[.Tau])</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(<span class="fu">call</span>(<span class="st">&quot;=&quot;</span>, <span class="fu">quote</span>(X[<span class="st">&quot;8 df&quot;</span>]<span class="sc">^</span>2L), gof))</span></code></pre></div>
<p><math><mrow><msubsup><mi>X</mi><mtext>8
df</mtext><mn>2</mn></msubsup><mo>=</mo><mrow><mo>∑</mo><mo>⁡</mo><msubsup><mi>z</mi><mi>τ</mi><mn>2</mn></msubsup></mrow></mrow></math></p>
<p>The degrees of freedom result from the 13 predicted mean response
times, minus 5 free parameters <span class="math inline">\(\theta =
\langle\mu_{\mathrm A}, \sigma_{\mathrm A}, \mu_{\mathrm B},
\sigma_{\mathrm B}, \mu_{\mathrm M}\rangle\)</span> (<span class="math inline">\(c\)</span> is a redundant scaling parameter).</p>
<p><math><mrow><mover accent="true"><mi>θ</mi><mo>^</mo></mover><mo>=</mo><mrow><mi>argmin</mi><mo>⁡</mo><mrow><mi>gof</mi><mo>⁡</mo><mrow><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mrow></mrow></mrow></math></p>
<p>The best fitting parameter values and their confidence intervals are
given in Table 5 below.</p>
<table>
<caption>Table 5. Model fit</caption>
<colgroup>
<col width="40%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Estimate</th>
<th align="left">Lo</th>
<th align="left">Up</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><math><msub><mi>μ</mi><mtext>A</mtext></msub></math></td>
<td align="left"><math><mn>0.53</mn></math></td>
<td align="left"><math><mn>0.51</mn></math></td>
<td align="left"><math><mn>0.56</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><msub><mi>σ</mi><mtext>A</mtext></msub></math></td>
<td align="left"><math><mn>4.51</mn></math></td>
<td align="left"><math><mn>3.89</mn></math></td>
<td align="left"><math><mn>5.12</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><msub><mi>μ</mi><mtext>B</mtext></msub></math></td>
<td align="left"><math><mn>1.38</mn></math></td>
<td align="left"><math><mn>1.24</mn></math></td>
<td align="left"><math><mn>1.51</mn></math></td>
</tr>
<tr class="even">
<td align="left"><math><msub><mi>σ</mi><mtext>B</mtext></msub></math></td>
<td align="left"><math><mn>13.24</mn></math></td>
<td align="left"><math><mn>7.45</mn></math></td>
<td align="left"><math><mn>19.03</mn></math></td>
</tr>
<tr class="odd">
<td align="left"><math><msub><mi>μ</mi><mtext>M</mtext></msub></math></td>
<td align="left"><math><mn>161.73</mn></math></td>
<td align="left"><math><mn>157.54</mn></math></td>
<td align="left"><math><mn>165.91</mn></math></td>
</tr>
</tbody>
</table>
<p>The statistic goodness-of-fit value is <span class="math inline">\(X^2(8) = 30.54\)</span>, <span class="math inline">\(p = .0002\)</span>, indicating some lack of fit.
Given the large trial numbers in the original study, some lack of fit is
expected. For more detail, especially on fitting the observed standard
deviations, the reader is referred to the original paper <span class="citation">(Schwarz 1994)</span>.</p>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>This package expands the possibilities of R by allowing calculations
and graphical rendering of the same terms. Building on current features
of R and existing packages for displaying formulas in R <span class="citation">(Murrell and Ihaka 2000; Allaire et al. 2018)</span>),
the <em>mathml</em> package bridges the gap between computational needs,
presentation of results, and their reproducibility. Two possible modes
for typesetting are available to export R Markdown documents in
different formats or ShinyApp webpages: MathML and MathJax. A further,
not-yet-mentioned, use of <em>mathml</em> is related to presentations
made using RMarkdown. By adopting <em>mathml</em> researchers or
teachers can use the RMarkdown to both conduct analysis and show
results, smoothing the process and uniforming the graphical output.</p>
<p>The case study presented above shows that <em>mathml</em> can help to
improve data analyses and statistical reports from an aesthetical
perspective, as well as regarding reproducibility of research.
Furthermore, the package may also allow for a better detection of
possible mistakes in R programs.</p>
<p>Similar to most programming languages <span class="citation">(Green
1977)</span>, R code is notoriously hard to read, and the poor
legibility of the language is one of the main sources of mistakes. For
illustration, we consider again Equation 10 in Schwarz <span class="citation">(1994)</span>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(tau)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>{ <span class="fu">dfrac</span>(c, mu[<span class="st">&quot;A&quot;</span>]) <span class="sc">+</span> (<span class="fu">dfrac</span>(1L, mu[<span class="st">&quot;A&quot;</span>]) <span class="sc">-</span> <span class="fu">dfrac</span>(1L, mu[<span class="st">&quot;A&quot;</span>] <span class="sc">+</span> mu[<span class="st">&quot;B&quot;</span>]) <span class="sc">*</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    ((mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau <span class="sc">-</span> c) <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">dfrac</span>(c <span class="sc">-</span> mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau, <span class="fu">sqrt</span>(sigma[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L<span class="sc">*</span>tau)))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> (mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau <span class="sc">+</span> c) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">dfrac</span>(2L<span class="sc">*</span>mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau, sigma[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">dfrac</span>(<span class="sc">-</span>c <span class="sc">-</span> mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau, <span class="fu">sqrt</span>(sigma[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L<span class="sc">*</span>tau)))))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(f1)</span></code></pre></div>
<p><math><mrow><mstyle displaystyle="true"><mfrac><mi>c</mi><msub><mi>μ</mi><mtext>A</mtext></msub></mfrac></mstyle><mo>+</mo><mrow><mo>{</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><msub><mi>μ</mi><mtext>A</mtext></msub></mfrac></mstyle><mo>-</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>+</mo><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mfrac></mstyle><mo>⋅</mo><mrow><mo>[</mo><mrow><mrow><mrow><mo>(</mo><mrow><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow><mo>-</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi>c</mi><mo>-</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow></mrow><msqrt><mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup><mo>⁢</mo><mi>τ</mi></mrow></msqrt></mfrac></mstyle><mo>)</mo></mrow></mrow></mrow><mo>-</mo><mrow><mrow><mrow><mo>(</mo><mrow><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow><mo>+</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mi>exp</mi><mo>⁡</mo><mstyle displaystyle="true"><mfrac><mrow><mrow><mn>2</mn><mo>⁢</mo><msub><mi>μ</mi><mtext>A</mtext></msub></mrow><mo>⁢</mo><mi>τ</mi></mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup></mfrac></mstyle></mrow></mrow><mo>⋅</mo><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mrow><mo>-</mo><mi>c</mi></mrow><mo>-</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow></mrow><msqrt><mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup><mo>⁢</mo><mi>τ</mi></mrow></msqrt></mfrac></mstyle><mo>)</mo></mrow></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo>}</mo></mrow></mrow></math></p>
<p>The first version has a wrong parenthesis, which is barely visible in
the code, whereas the wrong curly brace in the mathematical
representation is immediately obvious. The correct version is shown
below for comparison.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(tau)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>{ <span class="fu">dfrac</span>(c, mu[<span class="st">&quot;A&quot;</span>]) <span class="sc">+</span> (<span class="fu">dfrac</span>(1L, mu[<span class="st">&quot;A&quot;</span>]) <span class="sc">-</span> <span class="fu">dfrac</span>(1L, mu[<span class="st">&quot;A&quot;</span>] <span class="sc">+</span> mu[<span class="st">&quot;B&quot;</span>])) <span class="sc">*</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    ((mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau <span class="sc">-</span> c) <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">dfrac</span>(c <span class="sc">-</span> mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau, <span class="fu">sqrt</span>(sigma[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L<span class="sc">*</span>tau)))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> (mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau <span class="sc">+</span> c) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">dfrac</span>(2L<span class="sc">*</span>mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau, sigma[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">dfrac</span>(<span class="sc">-</span>c <span class="sc">-</span> mu[<span class="st">&quot;A&quot;</span>]<span class="sc">*</span>tau, <span class="fu">sqrt</span>(sigma[<span class="st">&quot;A&quot;</span>]<span class="sc">^</span>2L<span class="sc">*</span>tau))))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mathout</span>(f2)</span></code></pre></div>
<p><math><mrow><mstyle displaystyle="true"><mfrac><mi>c</mi><msub><mi>μ</mi><mtext>A</mtext></msub></mfrac></mstyle><mo>+</mo><mrow><mrow><mo>(</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><msub><mi>μ</mi><mtext>A</mtext></msub></mfrac></mstyle><mo>-</mo><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>+</mo><msub><mi>μ</mi><mtext>B</mtext></msub></mrow></mfrac></mstyle></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>[</mo><mrow><mrow><mrow><mo>(</mo><mrow><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow><mo>-</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi>c</mi><mo>-</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow></mrow><msqrt><mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup><mo>⁢</mo><mi>τ</mi></mrow></msqrt></mfrac></mstyle><mo>)</mo></mrow></mrow></mrow><mo>-</mo><mrow><mrow><mrow><mo>(</mo><mrow><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow><mo>+</mo><mi>c</mi></mrow><mo>)</mo></mrow><mo>⋅</mo><mrow><mi>exp</mi><mo>⁡</mo><mstyle displaystyle="true"><mfrac><mrow><mrow><mn>2</mn><mo>⁢</mo><msub><mi>μ</mi><mtext>A</mtext></msub></mrow><mo>⁢</mo><mi>τ</mi></mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup></mfrac></mstyle></mrow></mrow><mo>⋅</mo><mrow><mi>Φ</mi><mo>⁡</mo><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mrow><mo>-</mo><mi>c</mi></mrow><mo>-</mo><mrow><msub><mi>μ</mi><mtext>A</mtext></msub><mo>⁢</mo><mi>τ</mi></mrow></mrow><msqrt><mrow><msubsup><mi>σ</mi><mtext>A</mtext><mn>2</mn></msubsup><mo>⁢</mo><mi>τ</mi></mrow></msqrt></mfrac></mstyle><mo>)</mo></mrow></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow></math></p>
<p>As the reader may know from own experience, missed parentheses are
frequent causes of wrong results and errors that are hard to locate in
programming code. This particular example shows that mathematical
rendering can help to substantially reduce the amount of careless errors
in programming.</p>
<p>In its current version <em>mathml</em> has some limitations. For
example, it is currently not possible to use the functions of
<em>mathml</em> for writing intratextual formulas, here, the user has to
adopt the usual LateX notation. However, we do not consider this to be a
serious limitation, since the most productive use of <em>mathml</em>
still comes from more complicated calculations.</p>
<p>Also: In long equations, we did not yet find a convenient way to
insert linebreaks. This is mostly because it is not properly supported
by MathML and LaTeX renderers. In its current stage, the LaTeX package
<em>breqn</em> <span class="citation">(Robertson et al. 2021)</span> is
mostly a proof of concept.</p>
<p><em>mathml</em> is available for R version (…) and later, and can be
easily installed using the usual
<code>install.packages(&quot;mathml&quot;)</code>. The source code of the package
is found at <a href="https://github.com/mgondan/mathml" class="uri">https://github.com/mgondan/mathml</a>.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-allaire2018" class="csl-entry">
Allaire, JJ, Rich Iannone, Alison Presmanes Hill, and Yihui Xie. 2018.
<span>“Distill for r Markdown.”</span> <a href="https://rstudio.github.io/distill/">https://rstudio.github.io/distill/</a>.
</div>
<div id="ref-Chang2022" class="csl-entry">
Chang, Winston, Joe Cheng, JJ Allaire, Carson Sievert, Barret Schloerke,
Yihui Xie, Jeff Allen, Jonathan McPherson, Alan Dipert, and Barbara
Borges. 2022. <em>Shiny: Web Application Framework for r</em>. <a href="https://CRAN.R-project.org/package=shiny">https://CRAN.R-project.org/package=shiny</a>.
</div>
<div id="ref-rolog" class="csl-entry">
Gondan, Matthias. 2022. <em>Rolog: Query ’SWI’-’Prolog’ from r</em>. <a href="https://github.com/mgondan/rolog">https://github.com/mgondan/rolog</a>.
</div>
<div id="ref-green1977" class="csl-entry">
Green, T. R. G. 1977. <span>“Conditional Program Statements and Their
Comprehensibility to Professional Programmers.”</span> <em>Journal of
Occupational Psychology</em> 50: 93–109.
</div>
<div id="ref-murrell2000" class="csl-entry">
Murrell, Paul, and Ross Ihaka. 2000. <span>“An Approach to Providing
Mathematical Annotation in Plots.”</span> <em>Journal of Computational
and Graphical Statistics</em> 9: 582–99.
</div>
<div id="ref-R" class="csl-entry">
R Core Team. 2022. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-ratcliff2016" class="csl-entry">
Ratcliff, Roger, Philip L. Smith, Scott D. Brown, and Gail McKoon. 2016.
<span>“Diffusion Decision Model: Current Issues and History.”</span>
<em>Trends in Cognitive Sciences</em> 20: 260–81.
</div>
<div id="ref-breqn" class="csl-entry">
Robertson, Will, Joseph Wright, Frank Mittelbach, and Ulrike Fischer.
2021. <em>Breqn: Automatic Line Breaking of Displayed Equations</em>. <a href="https://www.ctan.org/pkg/breqn">https://www.ctan.org/pkg/breqn</a>.
</div>
<div id="ref-Sarkar2022" class="csl-entry">
Sarkar, Deepayan, and Kurt Hornik. 2022. <em>Enhancements to
<span>HTML</span> <span>D</span>ocumentation</em>. <a href="https://blog.r-project.org/2022/04/08/enhancements-to-html-documentation/index.html">https://blog.r-project.org/2022/04/08/enhancements-to-html-documentation/index.html</a>.
</div>
<div id="ref-schwarz1994" class="csl-entry">
Schwarz, Wolf. 1994. <span>“Diffusion, Superposition, and the
Redundant-Targets Effect.”</span> <em>Journal of Mathematical
Psychology</em> 38: 504–20.
</div>
<div id="ref-Viechtbauer2022" class="csl-entry">
Viechtbauer, Wolfgang. 2022. <em>Mathjaxr: Using ’Mathjax’ in Rd
Files</em>. <a href="https://CRAN.R-project.org/package=mathjaxr">https://CRAN.R-project.org/package=mathjaxr</a>.
</div>
<div id="ref-Wickham2019" class="csl-entry">
Wickham, H. 2019. <em>Advanced <span>R</span></em>. Cambridge: Chapman;
Hall/CRC.
</div>
<div id="ref-Xie2020" class="csl-entry">
Xie, Y., C. Dervieux, and E. Riederer. 2020. <em>R Markdown
Cookbook</em>. Cambridge: Chapman; Hall/CRC.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
